{
  "version": 3,
  "file": "local.js",
  "sourceRoot": "../src/",
  "sources": [
    "local.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "'use strict'\r\n\r\nsettings = require './settings'\r\nglob = require 'glob'\r\nfs = require 'fs'\r\npath = require 'path'\r\n\r\nmodule.exports = ->\r\n  clean = (key) ->\r\n    key = key.replace /:/g, 'IDBI'\r\n    key.replace /\\//g, 'IIDI'\r\n  unclean = (key) ->\r\n    key = key.replace /IDBI/g, ':'\r\n    key = key.replace /IIDI/g, '/'\r\n    regex = new RegExp '^' + path.join(settings.LOCAL_STORAGE) + '\\\\\\/'\r\n    key.replace regex, ''\r\n  checkDataDir: ->\r\n    if settings.LOCAL_STORAGE\r\n      exists = fs.existsSync path.join(settings.LOCAL_STORAGE)\r\n      if not exists\r\n        fs.mkdirSync path.join(settings.LOCAL_STORAGE)\r\n  keys: (from, prefix, cb) ->\r\n    ls = path.join(settings.LOCAL_STORAGE).replace(/\\\\/g, '/') + '/'\r\n    glob path.join(settings.LOCAL_STORAGE, clean(prefix) + '*.json'), (e, r) ->\r\n      if e\r\n        return cb e, null\r\n      i = -1\r\n      count = 0\r\n      gotFrom = not from\r\n      output = \r\n        Contents: []\r\n        IsTruncated: false\r\n      while ++i < r.length and count < 1000\r\n        r[i] = r[i].replace ls, ''\r\n        console.log ls\r\n        if gotFrom\r\n          output.Contents.push\r\n            Key: unclean r[i].replace('.json', '')\r\n          count++\r\n        else\r\n          if unclean(r[i]) is from + '.json'\r\n            gotFrom = true\r\n      if i < r.length\r\n        output.IsTruncated = true\r\n      cb? null, output\r\n  del: (key, cb) ->\r\n    console.log clean(key)\r\n    try\r\n      fs.unlinkSync path.join(settings.LOCAL_STORAGE, clean(key) + '.json')\r\n      cb? null, null\r\n    catch e\r\n      cb? e, null\r\n  put: (key, o, cb) ->\r\n    uri = path.join(settings.LOCAL_STORAGE, clean(key) + '.json')\r\n    fs.writeFile uri, JSON.stringify(o), (e) ->\r\n      cb? e, null\r\n  get: (key, cb) ->\r\n    fs.readFile path.join(settings.LOCAL_STORAGE, clean(key) + '.json'), 'utf8', (e, r) ->\r\n      d = null\r\n      if e and e.code and e.code is 'ENOENT'\r\n        return cb? 'ENOENT', null\r\n      try\r\n        d = JSON.parse r\r\n      catch e\r\n        return cb?(e or 'error', null)\r\n      cb? e, d\r\n  getReadStream: (key) ->\r\n    fs.createReadStream path.join(settings.LOCAL_STORAGE, clean(key) + '.json')\r\n  getWriteStream: (key, errorCb) ->\r\n    uri = path.join(settings.LOCAL_STORAGE, clean(key) + '.json')\r\n    fs.createWriteStream uri"
  ]
}